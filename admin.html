<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Админка NFT</title>
  <style>
    body { font-family: Arial; background: #f2f2f2; margin: 0; padding: 20px; }
    h1 { text-align: center; }
    .form-section, .history { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 10px; }
    input, select { margin: 5px 0; padding: 8px; width: 100%; box-sizing: border-box; }
    button { padding: 10px 15px; margin-top: 10px; background: #007bff; color: #fff; border: none; cursor: pointer; border-radius: 5px; }
    button:hover { background: #0056b3; }
    .history-grid { display: flex; flex-wrap: wrap; gap: 10px; }
    .nft-card {
      background: #f9f9f9;
      border: 1px solid #ccc;
      padding: 10px;
      width: 160px;
      border-radius: 8px;
      text-align: center;
    }
    .nft-card img { width: 100%; border-radius: 5px; }
  </style>
</head>
<body>

<h1>Панель администратора</h1>

<div class="form-section">
  <h2>Выпуск NFT</h2>
  <input type="text" id="modelName" placeholder="Модель (название)">
  <input type="text" id="title" placeholder="Название NFT">
  <input type="text" id="image" placeholder="Ссылка на изображение">
  <input type="text" id="rarity" placeholder="Редкость (0-100)">
  <button onclick="createNFT()">Создать NFT</button>
</div>

<div class="form-section">
  <h2>Управление балансом</h2>
  <input type="text" id="userLogin" placeholder="Логин пользователя">
  <input type="number" id="amount" placeholder="Сумма (можно отрицательную)">
  <button onclick="adjustBalance()">Изменить баланс</button>
</div>

<div class="form-section">
  <h2>Удаление NFT</h2>
  <input type="text" id="deleteCode" placeholder="Введите код NFT для удаления">
  <button onclick="deleteNFT()">Удалить NFT</button>
</div>

<div class="form-section">
  <h2>Удалить все NFT</h2>
  <button onclick="deleteAllNFTs()">Удалить всё</button>
</div>

<div class="history">
  <h2>История выпуска</h2>
  <div id="historyList" class="history-grid"></div>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getDatabase, ref, get, set, push, update, remove, onValue } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAAgeGGJAqYjQf0B8W_K7OX01aoriYeULo",
    authDomain: "nft-birga.firebaseapp.com",
    projectId: "nft-birga",
    storageBucket: "nft-birga.appspot.com",
    messagingSenderId: "387414090259",
    appId: "1:387414090259:web:8342f9a11174433dc895e6",
    databaseURL: "https://nft-birga-default-rtdb.firebaseio.com/"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  async function createNFT() {
    const model = document.getElementById("modelName").value.trim();
    const title = document.getElementById("title").value.trim();
    const image = document.getElementById("image").value.trim();
    const rarity = document.getElementById("rarity").value.trim();

    if (!model || !title || !image || !rarity) {
      alert("Заполните все поля");
      return;
    }

    const modelsRef = ref(db, 'models');
    const modelsSnap = await get(modelsRef);
    let models = modelsSnap.val() || {};

    if (!models[model]) models[model] = 0;
    models[model]++;

    const count = models[model];
    const code = String(count).padStart(7, '0') + "aa";
    const id = push(ref(db, 'nfts')).key;

    const nftData = {
      id,
      model,
      title,
      image,
      rarity,
      owner: "admin",
      price: 0,
      forSale: false,
      code
    };

    await set(ref(db, 'nfts/' + id), nftData);
    await set(modelsRef, models);
    alert("NFT создан");
    renderHistory();
  }

  async function adjustBalance() {
    const login = document.getElementById("userLogin").value.trim();
    const amount = parseFloat(document.getElementById("amount").value.trim());
    if (!login || isNaN(amount)) {
      alert("Введите данные");
      return;
    }

    const userRef = ref(db, 'users/' + login);
    const snap = await get(userRef);
    let current = snap.val() || { balance: 0, password: "" };
    current.balance += amount;

    await set(userRef, current);
    alert("Баланс обновлён");
  }

  async function deleteNFT() {
    const code = document.getElementById("deleteCode").value.trim();
    const snap = await get(ref(db, 'nfts'));
    const nfts = snap.val() || {};

    for (let key in nfts) {
      if (nfts[key].code === code) {
        await remove(ref(db, 'nfts/' + key));
        alert("NFT удалён");
        renderHistory();
        return;
      }
    }

    alert("NFT с таким кодом не найден");
  }

  async function deleteAllNFTs() {
    if (confirm("Точно удалить все NFT?")) {
      await set(ref(db, 'nfts'), {});
      alert("Все NFT удалены");
      renderHistory();
    }
  }

  async function renderHistory() {
    const snap = await get(ref(db, 'nfts'));
    const nfts = snap.val() || {};
    const container = document.getElementById("historyList");
    container.innerHTML = "";

    Object.values(nfts).forEach(nft => {
      const div = document.createElement("div");
      div.className = "nft-card";
      div.innerHTML = `
        <img src="${nft.image}">
        <p><strong>${nft.title}</strong></p>
        <p>Код: ${nft.code}</p>
        <p>Редкость: ${nft.rarity}</p>
      `;
      container.appendChild(div);
    });
  }

  renderHistory();
</script>

</body>
</html>


