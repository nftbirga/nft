<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Админка NFT</title>
  <style>
    body { font-family:sans-serif; background:#eef4fb; padding:20px; }
    .form { max-width:400px; background:#fff; padding:20px; margin-bottom:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .form input, .form select, .form button { width:100%; padding:12px; margin:8px 0; border-radius:4px; border:1px solid #ccc; }
    .form button { background:#0077cc; color:#fff; border:none; font-size:16px; cursor:pointer; }
    .history .nft { background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.15); padding:12px; margin-bottom:10px; display:flex; align-items:center; }
    .history img { width:60px; height:60px; object-fit:cover; margin-right:12px; border-radius:4px; }
    .history button { margin-left:auto; background:#ff4444; color:#fff; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; }
  </style>
</head>
<body>

<h1>Админка NFT</h1>

<div class="form">
  <h2>Создать NFT</h2>
  <input id="title" placeholder="Название модели">
  <input id="image" placeholder="URL изображения">
  <input id="price" placeholder="Цена в STAR" type="number">
  <select id="rarity">
    <option value="">— Выберите редкость —</option>
    <option value="0.01%">0.01%</option>
    <option value="0.1%">0.1%</option>
    <option value="0.5%">0.5%</option>
    <option value="1%">1%</option>
    <option value="2%">2%</option>
    <option value="3%">3%</option>
    <option value="4%">4%</option>
    <option value="5%">5%</option>
    <option value="tested">tested</option>
    <option value="error">error</option>
  </select>
  <input id="quantity" type="number" placeholder="Количество">
  <button onclick="createNFT()">Создать NFT</button>
</div>

<div class="history" id="history"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
import { getDatabase, ref, get, set, push, remove } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

const db = getDatabase(initializeApp({
  apiKey:"AIzaSyAAgeGGJAqYjQf0B8W_K7OX01aoriYeULo",
  authDomain:"nft-birga.firebaseapp.com",
  databaseURL:"https://nft-birga-default-rtdb.firebaseio.com",
  projectId:"nft-birga",
  storageBucket:"nft-birga.appspot.com",
  messagingSenderId:"387414090259",
  appId:"1:387414090259:web:8342f9a11174433dc895e6",
  measurementId:"G-2Q5WNT0VGQ"
}));

function letterCode(idx){
  return String.fromCharCode(97 + (idx % 26)) + String.fromCharCode(97 + Math.floor(idx/26));
}

async function createNFT(){
  const t = document.getElementById("title").value.trim();
  const im = document.getElementById("image").value.trim();
  const pr = Number(document.getElementById("price").value.trim());
  const r = document.getElementById("rarity").value;
  const q = Number(document.getElementById("quantity").value);
  if(!t||!im||!pr||!r||!q){ alert("Заполните все поля"); return;}
  for(let i=0;i<q;i++){
    const code = String(i+1).padStart(12,'0') + letterCode(Date.now()+i);
    await set(push(ref(db,"nfts")), { title:t, image:im, price:pr, rarity:r, code, owner:"admin", forSale:false });
  }
  showHistory();
}

async function showHistory(){
  const snap = await get(ref(db,"nfts"));
  const arr = Object.entries(snap.val()||{}).filter(([_,v])=>v.owner==="admin");
  document.getElementById("history").innerHTML = arr.map(([k,v])=>`
    <div class="nft">
      <img src="${v.image}">
      <div>${v.title} (${v.code})<br>${v.price} STAR • ${v.rarity}</div>
      <button onclick="deleteNFT('${k}')">Удалить</button>
    </div>`).join("");
}

window.createNFT = createNFT;
window.deleteNFT = async k => { await remove(ref(db,"nfts/"+k)); showHistory(); };

showHistory();
</script>

</body>
</html>

