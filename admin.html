<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Админка NFT (Firebase)</title>
  <style>
    body { font-family: sans-serif; background: #eef4fb; padding: 20px; color: #000; }
    input, select, button { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    .nft { background: #fff; border-radius: 8px; padding: 10px; margin-top: 10px; box-shadow: 0 0 5px #aaa; }
    img { width: 100%; border-radius: 6px; }
    .row { display: flex; gap: 20px; flex-wrap: wrap; }
    .half { flex: 1; min-width: 300px; }
  </style>
</head>
<body>

<h1>Админка: создать NFT</h1>

<div class="row">
  <div class="half">
    <input id="title" placeholder="Название модели" />
    <input id="image" placeholder="URL изображения" />
    <input id="price" placeholder="Цена (STAR)" />
    <select id="rarity">
      <option value="">Выбери редкость</option>
      <option value="0.01%">0.01%</option>
      <option value="0.1%">0.1%</option>
      <option value="0.5%">0.5%</option>
      <option value="1%">1%</option>
      <option value="2%">2%</option>
      <option value="3%">3%</option>
      <option value="4%">4%</option>
      <option value="5%">5%</option>
      <option value="tested">tested</option>
      <option value="error">error</option>
    </select>
    <input id="quantity" type="number" placeholder="Сколько NFT создать" />
    <button onclick="addModel()">Создать NFT</button>
  </div>

  <div class="half">
    <h2>Изменить баланс пользователя</h2>
    <input id="userLogin" placeholder="Логин" />
    <input id="amountToAdd" placeholder="Сумма (можно -)" />
    <button onclick="changeBalance()">Изменить баланс</button>
  </div>
</div>

<h2>История выпусков</h2>
<div id="history"></div>
<button style="margin-top:20px;background:#c00;color:#fff" onclick="deleteAllNFT()">❌ Удалить все NFT</button>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getDatabase, ref, set, push, onValue, get, remove, child, update } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAAgeGGJAqYjQf0B8W_K7OX01aoriYeULo",
    authDomain: "nft-birga.firebaseapp.com",
    projectId: "nft-birga",
    storageBucket: "nft-birga.appspot.com",
    messagingSenderId: "387414090259",
    appId: "1:387414090259:web:8342f9a11174433dc895e6",
    measurementId: "G-2Q5WNT0VGQ",
    databaseURL: "https://nft-birga-default-rtdb.firebaseio.com"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  async function addModel() {
    const title = titleInput.value.trim();
    const image = imageInput.value.trim();
    const price = priceInput.value.trim();
    const rarity = rarityInput.value;
    const quantity = parseInt(quantityInput.value);

    if (!title || !image || !price || !rarity || !quantity || quantity <= 0) {
      alert('Заполните все поля');
      return;
    }

    const modelKey = title.toLowerCase().replace(/\s+/g, "_");
    const modelRef = ref(db, 'models/' + modelKey);

    const snapshot = await get(modelRef);
    const count = snapshot.exists() ? snapshot.val().count || 0 : 0;

    const nftListRef = ref(db, 'nfts');
    for (let i = 0; i < quantity; i++) {
      const code = String(count + i + 1).padStart(7, '0') + "aa";
      const nft = {
        title, image, price, rarity, system: "extem beta",
        code, owner: "admin", forSale: false
      };
      push(nftListRef, nft);
    }

    await set(modelRef, { count: count + quantity });
    alert("NFT созданы");
    renderHistory();
  }

  async function renderHistory() {
    const historyDiv = document.getElementById('history');
    const snapshot = await get(ref(db, 'nfts'));
    if (!snapshot.exists()) return historyDiv.innerHTML = "Нет данных";

    const nfts = Object.values(snapshot.val()).filter(n => n.owner === "admin");
    historyDiv.innerHTML = nfts.map(n => `
      <div class="nft">
        <img src="${n.image}" />
        <h3>${n.title}</h3>
        <p>Код: ${n.code}</p>
        <p>Редкость: ${n.rarity}</p>
        <p>Цена: ${n.price} STAR</p>
      </div>
    `).join('');
  }

  async function changeBalance() {
    const login = document.getElementById('userLogin').value.trim();
    const amount = parseInt(document.getElementById('amountToAdd').value.trim());

    if (!login || isNaN(amount)) return alert('Неверные данные');

    const userRef = ref(db, 'users/' + login);
    const snap = await get(userRef);
    const user = snap.exists() ? snap.val() : { password: '', balance: 0 };
    user.balance = (user.balance || 0) + amount;
    await set(userRef, user);
    alert(`Баланс ${login} изменён на ${user.balance} STAR`);
  }

  async function deleteAllNFT() {
    if (!confirm("Удалить все NFT?")) return;
    await remove(ref(db, 'nfts'));
    alert("Удалено");
    renderHistory();
  }

  renderHistory();
</script>

</body>
</html>



