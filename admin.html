<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Админка NFT</title>
  <style>
    body { font-family: sans-serif; background: #eef4fb; padding: 20px; color: #000; }
    h1, h2 { color: #000; }
    input, select, button { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; font-size:16px; }
    button { cursor: pointer; background: #0077cc; color: white; border: none; border-radius: 6px; }
    button:hover { background: #005fa3; }
    .section { background: #fff; border-radius: 8px; padding: 15px; margin-top: 15px; box-shadow: 0 0 8px #aaa; max-width: 600px; }
    .nft-item { border-bottom: 1px solid #ddd; padding: 10px 0; display:flex; gap:10px; align-items:center; }
    .nft-item img { width: 80px; border-radius: 6px; }
    .nft-info { flex-grow: 1; }
    .nft-code { font-family: monospace; }
    .balance-inputs { display: flex; gap: 10px; }
    .balance-inputs input { flex:1; }
    .balance-inputs button { width: 120px; }
    .btn-delete { background: #ff4444; font-size: 14px; padding: 6px 12px; }
  </style>
</head>
<body>

<h1>Админка: выпуск NFT</h1>
<div class="section">
  <input id="title" placeholder="Название модели" />
  <input id="image" placeholder="URL изображения" />
  <input id="price" placeholder="Цена по умолчанию (STAR)" />
  <select id="rarity">
    <option value="">Выбери редкость</option>
    <option value="0.01%">0.01%</option>
    <option value="0.1%">0.1%</option>
    <option value="0.5%">0.5%</option>
    <option value="1%">1%</option>
    <option value="2%">2%</option>
    <option value="3%">3%</option>
    <option value="4%">4%</option>
    <option value="5%">5%</option>
    <option value="tested">tested</option>
    <option value="error">error</option>
  </select>
  <input id="quantity" type="number" placeholder="Сколько NFT выпустить" />
  <button onclick="addModel()">Выпустить NFT</button>
</div>

<h2>История выпущенных NFT</h2>
<div id="history" class="section" style="max-height: 400px; overflow-y: auto;"></div>

<h2>Управление балансом пользователей</h2>
<div class="section">
  <div class="balance-inputs">
    <input id="userLogin" placeholder="Логин пользователя" />
    <input id="amountToAdd" placeholder="Сумма (можно отрицательная)" type="number" />
  </div>
  <button onclick="changeBalance()">Изменить баланс</button>
</div>

<script>
  function padNum(num, len = 7) {
    return String(num).padStart(len, '0');
  }

  function generateNFTCode(modelIndex, indexInModel) {
    const letter1 = String.fromCharCode(97 + (modelIndex % 26));
    const letter2 = String.fromCharCode(97 + Math.floor(modelIndex / 26));
    return padNum(indexInModel + 1) + letter2 + letter1;
  }

  function getModels() {
    return JSON.parse(localStorage.getItem('nftModels')) || [];
  }
  function setModels(models) {
    localStorage.setItem('nftModels', JSON.stringify(models));
  }
  function getNFTs() {
    return JSON.parse(localStorage.getItem('nfts')) || {};
  }
  function setNFTs(nfts) {
    localStorage.setItem('nfts', JSON.stringify(nfts));
  }
  function getUsers() {
    return JSON.parse(localStorage.getItem('users')) || {};
  }
  function setUsers(users) {
    localStorage.setItem('users', JSON.stringify(users));
  }

  function addModel() {
    const title = document.getElementById('title').value.trim();
    const image = document.getElementById('image').value.trim();
    const price = parseFloat(document.getElementById('price').value.trim());
    const rarity = document.getElementById('rarity').value;
    const quantity = parseInt(document.getElementById('quantity').value.trim());

    if (!title || !image || isNaN(price) || !rarity || isNaN(quantity) || quantity <= 0) {
      alert('Заполните все поля корректно');
      return;
    }

    let models = getModels();
    let modelIndex = models.findIndex(m => m.title === title);
    if (modelIndex === -1) {
      modelIndex = models.length;
      models.push({ title, image, price, rarity, system: "extem beta" });
      setModels(models);
    } else {
      models[modelIndex].image = image;
      models[modelIndex].price = price;
      models[modelIndex].rarity = rarity;
      setModels(models);
    }

    let nfts = getNFTs();
    const existingCount = Object.values(nfts).filter(n => n.title === title).length;

    for (let i = 0; i < quantity; i++) {
      const code = generateNFTCode(modelIndex, existingCount + i);
      const id = Date.now() + i + Math.floor(Math.random()*1000);
      nfts[id] = {
        id,
        title,
        image,
        price,
        rarity,
        system: "extem beta",
        code,
        owner: 'admin',
        forSale: false,
      };
    }
    setNFTs(nfts);
    renderHistory();
    alert('NFT успешно выпущены!');
  }

  function renderHistory() {
    const nfts = getNFTs();
    const arr = Object.values(nfts).filter(n => n.owner === 'admin').sort((a,b) => b.id - a.id);
    const container = document.getElementById('history');
    if(arr.length === 0) {
      container.innerHTML = '<p>Пока нет выпущенных NFT.</p>';
      return;
    }
    container.innerHTML = arr.map(nft => `
      <div class="nft-item" id="nft-${nft.id}">
        <img src="${nft.image}" alt="${nft.title}" />
        <div class="nft-info">
          <b>${nft.title}</b><br>
          Код: <span class="nft-code">${nft.code}</span><br>
          Цена: ${nft.price} STAR<br>
          Редкость: ${nft.rarity}<br>
          Владелец: ${nft.owner}
        </div>
        <button class="btn-delete" onclick="deleteNFT('${nft.id}')">Удалить</button>
      </div>
    `).join('');
  }

  function deleteNFT(id) {
    if(!confirm('Удалить этот NFT?')) return;
    let nfts = getNFTs();
    delete nfts[id];
    setNFTs(nfts);
    renderHistory();
  }

  function changeBalance() {
    const login = document.getElementById('userLogin').value.trim();
    const amount = parseFloat(document.getElementById('amountToAdd').value.trim());
    if (!login || isNaN(amount)) {
      alert('Введите корректный логин и сумму');
      return;
    }
    let users = getUsers();
    if (!users[login]) users[login] = { password: '', balance: 0 };
    users[login].balance = (users[login].balance || 0) + amount;
    setUsers(users);
    alert(`Баланс пользователя ${login} изменён на ${amount} STAR`);
  }

  renderHistory();
</script>

</body>
</html>
