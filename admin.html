<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Админка NFT Биржи</title>
<style>
  body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; max-width: 900px; margin: auto; }
  h1 { text-align: center; color: #222; }
  form { margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 0 8px #ccc; }
  label { display: block; margin: 10px 0 5px; }
  input, select { width: 100%; padding: 8px; font-size: 16px; }
  button { margin-top: 15px; padding: 12px; font-size: 18px; background: #0077cc; color: white; border: none; border-radius: 6px; cursor: pointer; }
  button:hover { background: #005fa3; }
  table { width: 100%; border-collapse: collapse; margin-top: 25px; }
  th, td { padding: 8px; border: 1px solid #ddd; text-align: center; }
  th { background: #0077cc; color: white; }
  img { max-width: 80px; max-height: 60px; border-radius: 6px; }
  .delete-btn { background: #cc3300; }
  .delete-btn:hover { background: #990000; }
</style>
</head>
<body>

<h1>Админка NFT Биржи</h1>

<form id="createNFTForm">
  <label>Название NFT (модель):</label>
  <input type="text" id="modelName" placeholder="Например: Модель1" required />

  <label>Название подарка:</label>
  <input type="text" id="nftTitle" placeholder="Например: Подарок №1" required />

  <label>Редкость (например, 0.01%, 1%, tested):</label>
  <input type="text" id="nftRarity" placeholder="0.01%" required />

  <label>Изображение (URL):</label>
  <input type="url" id="nftImage" placeholder="https://example.com/image.png" required />

  <button type="submit">Выпустить NFT</button>
</form>

<h2>История выпуска NFT</h2>
<table id="historyTable">
  <thead>
    <tr>
      <th>Код</th>
      <th>Название</th>
      <th>Модель</th>
      <th>Редкость</th>
      <th>Изображение</th>
      <th>Владелец</th>
      <th>Удалить</th>
    </tr>
  </thead>
  <tbody>
    <!-- Записи будут тут -->
  </tbody>
</table>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getDatabase, ref, get, set, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

  // Настройки Firebase - используй свои
  const firebaseConfig = {
    apiKey: "AIzaSyAAgeGGJAqYjQf0B8W_K7OX01aoriYeULo",
    authDomain: "nft-birga.firebaseapp.com",
    databaseURL: "https://nft-birga-default-rtdb.firebaseio.com/",
    projectId: "nft-birga",
    storageBucket: "nft-birga.appspot.com",
    messagingSenderId: "387414090259",
    appId: "1:387414090259:web:8342f9a11174433dc895e6",
    measurementId: "G-2Q5WNT0VGQ"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Для нумерации кода по модели:
  async function getModelCounter(model) {
    const snap = await get(ref(db, 'modelCounters/' + model));
    return snap.exists() ? snap.val() : 0;
  }
  async function setModelCounter(model, val) {
    await set(ref(db, 'modelCounters/' + model), val);
  }

  // Создать новый NFT
  document.getElementById('createNFTForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const model = document.getElementById('modelName').value.trim();
    const title = document.getElementById('nftTitle').value.trim();
    const rarity = document.getElementById('nftRarity').value.trim();
    const image = document.getElementById('nftImage').value.trim();

    if (!model || !title || !rarity || !image) {
      alert('Заполните все поля');
      return;
    }

    let counter = await getModelCounter(model);
    counter++;
    await setModelCounter(model, counter);

    // Формируем код вида: 0000001aa - 12 цифр с буквами aa (шаблон)
    // Будем кодировать номер в hex + 'aa' в конце для простоты:
    let codeNum = counter.toString(16).padStart(9, '0'); // 9 hex символов
    let code = codeNum + 'aa';

    // Формируем уникальный id для NFT
    let id = model + '_' + code;

    // Создаем объект NFT
    let nft = {
      id,
      code,
      model,
      title,
      rarity,
      image,
      owner: "admin", // при выпуске принадлежит админке
      forSale: false,
      price: 0
    };

    // Записываем в базу
    await set(ref(db, 'nfts/' + id), nft);

    alert('NFT выпущен: ' + title + ' с кодом ' + code);

    // Очистить форму
    e.target.reset();

    // Обновить таблицу
    loadHistory();
  });

  // Загрузить и показать историю NFT
  async function loadHistory() {
    const tbody = document.querySelector('#historyTable tbody');
    tbody.innerHTML = '';

    const snap = await get(ref(db, 'nfts'));
    if (!snap.exists()) return;

    const nfts = snap.val();

    Object.values(nfts).forEach(nft => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${nft.code}</td>
        <td>${nft.title}</td>
        <td>${nft.model}</td>
        <td>${nft.rarity}</td>
        <td><img src="${nft.image}" alt="${nft.title}" /></td>
        <td>${nft.owner}</td>
        <td><button class="delete-btn" data-id="${nft.id}">Удалить</button></td>
      `;
      tbody.appendChild(tr);
    });

    // Вешаем обработчики удаления
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.onclick = async () => {
        if (confirm('Удалить этот NFT?')) {
          const id = btn.dataset.id;
          await remove(ref(db, 'nfts/' + id));
          alert('NFT удалён');
          loadHistory();
        }
      };
    });
  }

  loadHistory();

</script>

</body>
</html>



