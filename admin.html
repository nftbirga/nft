<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><title>Админка NFT</title>
<style>
body{font-family:sans-serif;background:#eef4fb;padding:20px;}
.form{background:#fff;padding:20px;margin-bottom:20px;border-radius:8px;max-width:400px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.form input,.form select,.form button{width:100%;padding:12px;margin:8px 0;border-radius:4px;border:1px solid #ccc;font-size:16px;}
.form button{background:#0077cc;color:#fff;border:none;cursor:pointer;}
.history .nft{background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.15);padding:12px;display:flex;align-items:center;max-width:400px;margin-bottom:10px;}
.history img{width:60px;height:60px;object-fit:cover;margin-right:12px;border-radius:4px;}
.history button{margin-left:auto;background:#ff4444;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;}
</style></head><body>
<h1>Админка NFT</h1>
<div class="form">
  <h2>Создать NFT</h2>
  <input id="title" placeholder="Название модели">
  <input id="image" placeholder="URL изображения">
  <input id="price" placeholder="Цена в STAR" type="number">
  <select id="rarity"><option value="">— Редкость —</option>
    <option value="0.01%">0.01%</option><option value="0.1%">0.1%</option><option value="0.5%">0.5%</option>
    <option value="1%">1%</option><option value="2%">2%</option><option value="3%">3%</option><option value="4%">4%</option>
    <option value="5%">5%</option><option value="tested">tested</option><option value="error">error</option>
  </select>
  <input id="quantity" type="number" placeholder="Количество">
  <button onclick="createNFT()">Создать NFT</button>
</div>
<div class="history" id="history"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
import { getDatabase, ref, get, push, set, remove } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";
const db = getDatabase(initializeApp({
  apiKey:"AIzaSyAAgeGGJAqYjQf0...",authDomain:"nft-birga.firebaseapp.com",
  databaseURL:"https://nft-birga-default-rtdb.firebaseio.com",projectId:"nft-birga",
  storageBucket:"nft-birga.appspot.com",messagingSenderId:"387414090259",
  appId:"1:387414090259:web:xyz",measurementId:"G-2Q5..."
}));

function getSuffix(idx){
  const a = 97 + (idx % 26); const b = 97 + Math.floor(idx / 26);
  return String.fromCharCode(a)+String.fromCharCode(b);
}

async function createNFT(){
  const t = document.getElementById("title").value.trim();
  const im = document.getElementById("image").value.trim();
  const pr = +document.getElementById("price").value;
  const r = document.getElementById("rarity").value;
  const q = +document.getElementById("quantity").value;
  if(!t||!im||!pr||!r||!q){alert("Заполните все поля");return;}
  
  const modelRef = ref(db, "models/" + t);
  const moSnap = await get(modelRef);
  let count = moSnap.exists() ? moSnap.val().count : 0;
  await set(modelRef, { count: count + q });

  for(let i = 1; i <= q; i++){
    const idx = count + i;
    const num = String(idx).padStart(7, '0');
    const code = num + getSuffix(idx);
    await set(push(ref(db, "nfts")), {
      title: t, image: im, price: pr, rarity: r,
      code, owner: "admin", forSale: false
    });
  }

  showHistory();
}

async function showHistory(){
  const snap = await get(ref(db, "nfts"));
  document.getElementById("history").innerHTML = Object.entries(snap.val()||{})
    .filter(([_,v])=>v.owner === "admin")
    .map(([k,v])=>`
      <div class="nft">
        <img src="${v.image}">
        <div><b>${v.title}</b><br>${v.code}<br>${v.price}★ • ${v.rarity}</div>
        <button onclick="deleteNFT('${k}')">Удалить</button>
      </div>
    `).join("");
}

window.deleteNFT = async k=>{
  await remove(ref(db, "nfts/"+k));
  showHistory();
};

window.createNFT = createNFT;
showHistory();

</script>
</body></html>


