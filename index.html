<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><title>Биржа NFT</title>
<style>
 body{margin:0;padding:0;font-family:sans-serif;background:#eef4fb;}
 header{background:#0077cc;color:#fff;padding:15px;text-align:center;}
 #content, #profile{max-width:600px;margin:auto;padding:20px;}
 .card{background:#fff;padding:10px;margin:10px;border-radius:6px;box-shadow:0 0 5px #aaa;}
 .card img{max-width:100%;height:120px;}
 .card button{padding:8px;border:none;border-radius:4px;background:#0077cc;color:#fff;cursor:pointer;}
 .salePrice{width:60px;margin-right:8px;}
</style></head><body>
<header><h1>Биржа NFT</h1><div id="userinfo"></div></header>

<div id="login">
  <input id="uLogin" placeholder="Логин"><input id="uPass" type="password" placeholder="Пароль">
  <button onclick="login()">Войти/Регистрация</button>
</div>

<div id="content" style="display:none;">
  <h3>Все NFT</h3><div id="allNFTs"></div>
</div>

<div id="profile" style="display:none;">
  <h3>Мои NFT</h3><div id="myNFTs"></div><button onclick="logout()">Выйти</button>
</div>

<script>
function getUsers(){return JSON.parse(localStorage.getItem('users')||'{}');}
function saveUsers(u){localStorage.setItem('users',JSON.stringify(u));}
function getNFTs(){return JSON.parse(localStorage.getItem('nfts')||'{}');}
function saveNFTs(n){localStorage.setItem('nfts',JSON.stringify(n));}
let me=null;

function login(){
  const l=document.getElementById('uLogin').value.trim(), p=document.getElementById('uPass').value.trim();
  if(!l||!p) return alert('Введите логин и пароль');
  const u=getUsers();
  if(!u[l]) u[l]={password:p,balance:0};
  else if(u[l].password!==p) return alert('Неверный пароль');
  saveUsers(u); me=l; init();
}

function logout(){me=null;location.reload();}

function init(){
  document.getElementById('login').style.display='none';
  document.getElementById('content').style.display='block';
  document.getElementById('profile').style.display='block';
  document.getElementById('userinfo').innerText = 'Пользователь: '+me+' • Баланс: '+getUsers()[me].balance+'★';
  renderAll(); renderMy();
}

function renderAll(){
  const n=Object.values(getNFTs());
  document.getElementById('allNFTs').innerHTML = n.map(x=>`
    <div class="card">
      <img src="${x.image}">
      <b>${x.title}</b><br>${x.code}<br>${x.price}★ • ${x.rarity}<br>Владелец: ${x.owner}<br>
      ${x.forSale && x.owner!==me ? `<button onclick="buy('${x.id}')">Купить</button>` : ''}
    </div>`).join('');
}

function renderMy(){
  const meNFT = Object.values(getNFTs()).filter(x=>x.owner===me);
  document.getElementById('myNFTs').innerHTML = meNFT.map(x=>`
    <div class="card">
      <img src="${x.image}">
      <b>${x.title}</b><br>${x.code}<br>
      <input class="salePrice" id="p${x.id}" placeholder="Цена"><button onclick="toggleSale('${x.id}')">
        ${x.forSale?'Снять':'Продать'}
      </button>
    </div>`).join('');
}

function toggleSale(id){
  const nfts=getNFTs(), u=getUsers();
  const x=nfts[id];
  if(!x) return;
  if(x.forSale){
    x.forSale=false;
  } else {
    const p=parseFloat(document.getElementById('p'+id).value);
    if(!p||p<=0) return alert('Цена > 0');
    x.price=p; x.forSale=true;
  }
  saveNFTs(nfts); renderAll(); renderMy();
}

function buy(id){
  const nfts=getNFTs(), u=getUsers();
  const x=nfts[id];
  if(u[me].balance < x.price) return alert('Недостаточно средств');
  u[me].balance -= x.price;
  u[x.owner].balance += x.price;
  x.owner=me; x.forSale=false;
  saveUsers(u); saveNFTs(nfts);
  document.getElementById('userinfo').innerText = 'Пользователь: '+me+' • Баланс: '+u[me].balance+'★';
  renderAll(); renderMy();
  alert('Куплено!');
}
</script>
</body></html>

