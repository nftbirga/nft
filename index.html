<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>NFT Биржа с фильтрами</title>
<style>
  body {
    font-family: sans-serif;
    background: #e6f0fa;
    margin: 0; padding: 0;
  }
  header {
    background: #0077cc;
    color: white;
    padding: 15px;
    text-align: center;
    position: relative;
  }
  #userInfo {
    position: absolute;
    right: 15px;
    top: 18px;
    color: black;
    background: white;
    padding: 5px 10px;
    border-radius: 8px;
    font-weight: bold;
  }
  #loginBox {
    max-width: 300px;
    margin: 30px auto;
    text-align: center;
  }
  #loginBox input {
    width: 90%;
    padding: 10px;
    margin: 10px 0;
    font-size: 16px;
  }
  #loginBox button {
    width: 90%;
    padding: 12px;
    font-size: 18px;
    background: #0077cc;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #filterBar {
    max-width: 800px;
    margin: 10px auto;
    display: flex;
    gap: 20px;
    justify-content: center;
  }
  #filterBar select {
    padding: 8px 12px;
    font-size: 16px;
    border-radius: 6px;
  }
  #nftContainer {
    max-width: 900px;
    margin: 0 auto 80px;
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
  }
  .card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 0 5px #aaa;
    width: 220px;
    padding: 10px;
    text-align: center;
  }
  .card img {
    width: 100%;
    border-radius: 8px;
  }
  .card button {
    margin-top: 8px;
    padding: 8px;
    width: 90%;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    background: #0077cc;
    color: white;
    font-weight: bold;
  }
  .card button:hover {
    background: #005fa3;
  }
  #telegramFooter {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: #0088cc;
    text-align: center;
    padding: 8px 0;
  }
  #telegramFooter a img {
    height: 30px;
    vertical-align: middle;
  }
</style>
</head>
<body>

<header>
  <h1>NFT Биржа</h1>
  <div id="userInfo" style="display:none"></div>
</header>

<div id="loginBox">
  <input id="login" placeholder="Логин" />
  <input id="password" type="password" placeholder="Пароль" />
  <button onclick="login()">Войти / Регистрация</button>
</div>

<div id="filterBar" style="display:none;">
  <select id="priceFilter">
    <option value="none">Фильтр по цене</option>
    <option value="asc">По возрастанию</option>
    <option value="desc">По убыванию</option>
  </select>
  <select id="rarityFilter">
    <option value="none">Фильтр по редкости</option>
    <option value="0.01%">0.01%</option>
    <option value="0.1%">0.1%</option>
    <option value="0.5%">0.5%</option>
    <option value="1%">1%</option>
    <option value="2%">2%</option>
    <option value="3%">3%</option>
    <option value="4%">4%</option>
    <option value="5%">5%</option>
    <option value="tested">tested</option>
    <option value="error">error</option>
  </select>
</div>

<div id="nftContainer" style="display:none;"></div>

<div id="telegramFooter">
  <a href="https://t.me/Maxsimka172" target="_blank" rel="noopener noreferrer" title="Telegram @Maxsimka172">
    <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram" />
  </a>
</div>

<script>
  let currentUser = null;
  let allNFTs = [];

  // Вход / регистрация
  function login() {
    const loginInput = document.getElementById('login').value.trim();
    const passwordInput = document.getElementById('password').value.trim();

    if (!loginInput || !passwordInput) {
      alert('Введите логин и пароль');
      return;
    }

    let users = JSON.parse(localStorage.getItem('users')) || {};

    if (!users[loginInput]) {
      users[loginInput] = { password: passwordInput, balance: 0 };
    } else if (users[loginInput].password !== passwordInput) {
      alert('Неверный пароль');
      return;
    }

    localStorage.setItem('users', JSON.stringify(users));
    currentUser = loginInput;

    document.getElementById('loginBox').style.display = 'none';
    document.getElementById('filterBar').style.display = 'flex';
    document.getElementById('nftContainer').style.display = 'flex';
    updateUserInfo();
    loadNFTs();
  }

  // Обновление инфо пользователя (баланс)
  function updateUserInfo() {
    if (!currentUser) return;
    const users = JSON.parse(localStorage.getItem('users'));
    if (!users || !users[currentUser]) return;

    const userInfoDiv = document.getElementById('userInfo');
    userInfoDiv.style.display = 'block';
    userInfoDiv.innerHTML = `Пользователь: <b>${currentUser}</b> | Баланс: <span style="color:black;">${users[currentUser].balance} STAR</span> | <button onclick="logout()" style="margin-left:10px;padding:4px 8px;cursor:pointer;">Выйти</button>`;
  }

  // Выход из аккаунта
  function logout() {
    currentUser = null;
    document.getElementById('loginBox').style.display = 'block';
    document.getElementById('filterBar').style.display = 'none';
    document.getElementById('nftContainer').style.display = 'none';
    document.getElementById('userInfo').style.display = 'none';
  }

  // Загрузка NFT из localStorage
  function loadNFTs() {
    allNFTs = JSON.parse(localStorage.getItem('nfts')) || [];
    renderNFTs();
  }

  // Применить фильтры и отрисовать NFT
  function renderNFTs() {
    const container = document.getElementById('nftContainer');
    let filteredNFTs = [...allNFTs];

    // Фильтр по цене
    const priceFilter = document.getElementById('priceFilter').value;
    if (priceFilter === 'asc') {
      filteredNFTs.sort((a,b) => Number(a.price) - Number(b.price));
    } else if (priceFilter === 'desc') {
      filteredNFTs.sort((a,b) => Number(b.price) - Number(a.price));
    }

    // Фильтр по редкости
    const rarityFilter = document.getElementById('rarityFilter').value;
    if (rarityFilter !== 'none') {
      filteredNFTs = filteredNFTs.filter(nft => nft.rarity === rarityFilter);
    }

    container.innerHTML = '';

    if (filteredNFTs.length === 0) {
      container.textContent = 'NFT не найдены';
      return;
    }

    filteredNFTs.forEach(nft => {
      const card = document.createElement('div');
      card.className = 'card';

      let actionButtons = '';

      if (nft.owner === currentUser && !nft.forSale) {
        actionButtons = `<button onclick="sellNFT(${nft.id})">Продать</button>`;
      } else if (nft.forSale && nft.owner !== currentUser) {
        actionButtons = `<button onclick="buyNFT(${nft.id})">Купить</button>`;
      } else if (nft.owner === currentUser && nft.forSale) {
        actionButtons = `<button onclick="cancelSale(${nft.id})">Снять с продажи</button>`;
      }

      card.innerHTML = `
        <img src="${nft.image}" alt="${nft.title}" />
        <h3>${nft.title}</h3>
        <p>Код: ${nft.code}</p>
        <p>Редкость: ${nft.rarity}</p>
        <p>Владелец: ${nft.owner}</p>
        <p>Цена: ${nft.forSale ? nft.price + ' STAR' : 'Не на продаже'}</p>
        ${actionButtons}
      `;

      container.appendChild(card);
    });
  }

  // Продать NFT (установка цены и выставление на продажу)
  function sellNFT(id) {
    const priceStr = prompt('Введите цену за NFT (в STAR, >= 0)');
    if (priceStr === null) return; // отмена
    const price = Number(priceStr);
    if (isNaN(price) || price < 0) {
      alert('Цена должна быть числом не меньше 0');
      return;
    }

    const nfts = JSON.parse(localStorage.getItem('nfts')) || [];
    const nftIndex = nfts.findIndex(n => n.id === id);
    if (nftIndex === -1) return alert('NFT не найден');

    if (nfts[nftIndex].owner !== currentUser) {
      alert('Вы не владелец этого NFT');
      return;
    }

    nfts[nftIndex].price = price;
    nfts[nftIndex].forSale = true;

    localStorage.setItem('nfts', JSON.stringify(nfts));
    allNFTs = nfts;
    renderNFTs();
  }

  // Купить NFT
  function buyNFT(id) {
    const nfts = JSON.parse(localStorage.getItem('nfts')) || [];
    const nftIndex = nfts.findIndex(n => n.id === id);
    if (nftIndex === -1) return alert('NFT не найден');

    const nft = nfts[nftIndex];
    if (!nft.forSale) {
      alert('NFT не выставлен на продажу');
      return;
    }

    const users = JSON.parse(localStorage.getItem('users')) || {};
    const buyer = users[currentUser];
    if (!buyer || buyer.balance < nft.price) {
      alert('Недостаточно STAR для покупки');
      return;
    }

    // Перевод средств
    buyer.balance -= Number(nft.price);
    if (!users[nft.owner]) users[nft.owner] = { password: '', balance: 0 };
    users[nft.owner].balance += Number(nft.price);

    // Передача NFT
    nft.owner = currentUser;
    nft.forSale = false;

    users[currentUser] = buyer;
    nfts[nftIndex] = nft;

    localStorage.setItem('users', JSON.stringify(users));
    localStorage.setItem('nfts', JSON.stringify(nfts));

    allNFTs = nfts;
    updateUserInfo();
    renderNFTs();
  }

  // Снять с продажи
  function cancelSale(id) {
    const nfts = JSON.parse(localStorage.getItem('nfts')) || [];
    const nftIndex = nfts.findIndex(n => n.id === id);
    if (nftIndex === -1) return alert('NFT не найден');

    if (nfts[nftIndex].owner !== currentUser) {
      alert('Вы не владелец этого NFT');
      return;
    }

    nfts[nftIndex].forSale = false;
    localStorage.setItem('nfts', JSON.stringify(nfts));
    allNFTs = nfts;
    renderNFTs();
  }

  // События на фильтры
  document.getElementById('priceFilter').addEventListener('change', renderNFTs);
  document.getElementById('rarityFilter').addEventListener('change', renderNFTs);
</script>

</body>
</html>


